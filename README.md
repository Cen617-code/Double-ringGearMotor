# Double-ringGearMotor（双环齿轮电机 — 双轴步进电机插补控制系统）

## 项目简介

本项目是基于 **8051 单片机**（STC89C52 系列）的双轴步进电机插补控制系统，使用 **Keil C51** 工具链进行开发与编译。系统通过串口接收上位机指令，驱动两台步进电机（X 轴 / Y 轴）协同运动，实现了以下核心功能：

- **直线插补（Line Interpolation）**：基于 Bresenham 算法实现任意两点间的直线运动。
- **圆弧插补（Arc Interpolation）**：基于逐点比较法，支持四象限、顺时针 / 逆时针的圆弧轨迹运动。
- **串口指令控制**：通过 UART（9600 bps）接收文本指令，实时启停和配置运动参数。

## 目录结构

```text
.
├── main.c              # 主程序源码（电机控制、插补算法、串口通信）
├── STARTUP.A51         # Keil C51 标准启动文件（初始化内存与堆栈）
├── TEST.uvproj         # Keil µVision 工程文件
├── TEST.uvopt          # Keil µVision 工程选项
├── TEST.uvgui.*        # Keil µVision GUI 布局配置文件
├── Listings/           # 编译生成的列表文件（.lst, .m51）
└── Objects/            # 编译生成的目标文件（.obj, .hex 等）
```

## 硬件接口

系统通过 8051 的 P1 端口控制两路步进电机驱动器：

| 引脚 | 信号 | 说明 |
|------|------|------|
| `P1.0` | `PUL` | 电机 1 脉冲信号（X 轴） |
| `P1.1` | `DIR` | 电机 1 方向信号（X 轴） |
| `P1.2` | `ENA` | 电机 1 使能信号（低电平有效） |
| `P1.7` | `PUL2` | 电机 2 脉冲信号（Y 轴） |
| `P1.6` | `DIR2` | 电机 2 方向信号（Y 轴） |

- **定时器 T0**：工作在模式 1（16 位），产生 0.5ms 定时中断，驱动脉冲输出。
- **定时器 T1**：工作在模式 2（8 位自动重装），作为 UART 波特率发生器（9600 bps @12MHz 晶振）。

## 串口指令协议

系统上电后通过 UART 输出 `READY` 提示，随后等待以下文本指令（以回车 `\r` 或换行 `\n` 结尾）：

| 指令格式 | 说明 |
|---------|------|
| `LINE x0 y0 x1 y1` | 从坐标 `(x0, y0)` 到 `(x1, y1)` 执行直线插补 |
| `ARC_CW x0 y0 x1 y1 r` | 从 `(x0, y0)` 到 `(x1, y1)` 执行半径为 `r` 的**顺时针**圆弧插补 |
| `ARC_CCW x0 y0 x1 y1 r` | 从 `(x0, y0)` 到 `(x1, y1)` 执行半径为 `r` 的**逆时针**圆弧插补 |
| `STOP` | 立即停止当前运动 |

运动完成后系统会通过串口回传状态信息（如 `LINE INTERP DONE`、`ARC INTERP DONE`）。

## 核心算法

### 直线插补

采用 **Bresenham 直线算法** 的变种实现。在每个定时中断周期内，通过偏差判别决定 X 或 Y 方向的进给，并翻转对应电机的脉冲信号，实现两轴协调的直线运动。

### 圆弧插补

采用**逐点比较法**实现。核心思路：
1. 根据当前点坐标计算偏差值 $$F = x^2 + y^2 - R^2$$
2. 判断偏差符号，决定进给方向（沿 X 或 Y）。
3. 根据当前象限（1~4）和旋转方向（CW / CCW）查表确定具体的坐标递增 / 递减操作。
4. 每步进后重新判断象限并更新偏差值。

## 开发与编译

### 环境要求

- **Keil µVision**（C51 编译器）
- 8051 兼容开发板（如 STC89C52）

### 编译步骤

1. 使用 Keil µVision 打开工程文件 `TEST.uvproj`。
2. 点击 **Build → Rebuild All** 编译项目。
3. 编译成功后，`Objects/TEST.hex` 即为可烧录的固件文件。
4. 使用 STC-ISP 或其他下载工具将 `.hex` 文件烧录至目标单片机。

### 调试

- 使用串口调试工具（如 SSCOM、Putty）连接单片机的 UART 端口，波特率设置为 **9600, 8N1**。
- 发送上述指令即可控制电机运动，观察返回的状态信息。
